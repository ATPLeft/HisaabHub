<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HisaabHub - Signup Debugger</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7f9;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            margin-bottom: 10px;
        }
        
        .debug-panel {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input[type="text"], input[type="email"], input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .test-btn {
            background: #2ecc71;
            margin-right: 10px;
        }
        
        .test-btn:hover {
            background: #27ae60;
        }
        
        .debug-btn {
            background: #e74c3c;
        }
        
        .debug-btn:hover {
            background: #c0392b;
        }
        
        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .success {
            border-left-color: #2ecc71;
        }
        
        .error {
            border-left-color: #e74c3c;
        }
        
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin-top: 15px;
        }
        
        .step {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .step-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .step-content {
            flex-grow: 1;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            border-radius: 6px 6px 0 0;
        }
        
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .tab button:hover {
            background-color: #ddd;
        }
        
        .tab button.active {
            background-color: #3498db;
            color: white;
        }
        
        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 6px 6px;
            background: white;
            animation: fadeEffect 1s;
        }
        
        @keyframes fadeEffect {
            from {opacity: 0;}
            to {opacity: 1;}
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>HisaabHub Signup Debugger</h1>
            <p>Diagnose and fix signup issues with your deployed application</p>
        </header>
        
        <div class="debug-panel">
            <h2>Debugging Steps</h2>
            
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <p><strong>Check Environment Variables</strong> - Ensure your backend has correct database connection strings and other environment variables configured on Render.</p>
                </div>
            </div>
            
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <p><strong>Verify Database Connection</strong> - Test if your backend can connect to the Postgres database on Render.</p>
                </div>
            </div>
            
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <p><strong>Check CORS Configuration</strong> - Ensure your backend allows requests from your Vercel frontend domain.</p>
                </div>
            </div>
            
            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <p><strong>Test API Endpoints</strong> - Verify that your signup API endpoint is working correctly.</p>
                </div>
            </div>
            
            <div class="step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <p><strong>Review Server Logs</strong> - Check the logs on Render for any error messages during signup attempts.</p>
                </div>
            </div>
        </div>
        
        <div class="debug-panel">
            <div class="tab">
                <button class="tablinks active" onclick="openTab(event, 'ConnectionTest')">Connection Test</button>
                <button class="tablinks" onclick="openTab(event, 'SignupTest')">Signup Test</button>
                <button class="tablinks" onclick="openTab(event, 'LogAnalysis')">Log Analysis</button>
            </div>
            
            <div id="ConnectionTest" class="tabcontent" style="display:block;">
                <h2>API Connection Test</h2>
                <div class="form-group">
                    <label for="backendUrl">Backend API URL (from Render):</label>
                    <input type="text" id="backendUrl" placeholder="https://your-app-name.onrender.com" value="">
                </div>
                
                <button id="testConnectionBtn" class="test-btn">Test Connection</button>
                
                <div id="connectionResults" class="results hidden">
                    <h3>Test Results</h3>
                    <pre id="connectionResultText"></pre>
                </div>
            </div>
            
            <div id="SignupTest" class="tabcontent">
                <h2>Signup Functionality Test</h2>
                <div class="form-group">
                    <label for="testName">Full Name:</label>
                    <input type="text" id="testName" placeholder="Enter test name" value="Test User">
                </div>
                
                <div class="form-group">
                    <label for="testEmail">Email Address:</label>
                    <input type="email" id="testEmail" placeholder="Enter test email" value="test@example.com">
                </div>
                
                <div class="form-group">
                    <label for="testPassword">Password:</label>
                    <input type="password" id="testPassword" placeholder="Enter test password" value="password123">
                </div>
                
                <button id="testSignupBtn" class="test-btn">Test Signup</button>
                
                <div id="signupResults" class="results hidden">
                    <h3>Test Results</h3>
                    <pre id="signupResultText"></pre>
                </div>
            </div>
            
            <div id="LogAnalysis" class="tabcontent">
                <h2>Common Error Log Patterns</h2>
                <p>Check your Render backend logs for these common error patterns:</p>
                
                <div class="form-group">
                    <h3>Database Connection Errors</h3>
                    <pre>Error: connect ECONNREFUSED
Error: password authentication failed
Error: database "dbname" does not exist</pre>
                </div>
                
                <div class="form-group">
                    <h3>CORS Errors</h3>
                    <pre>Access to fetch at 'https://backend.url' from origin 'https://frontend.url' 
has been blocked by CORS policy</pre>
                </div>
                
                <div class="form-group">
                    <h3>Environment Variable Issues</h3>
                    <pre>Error: Missing environment variable: DATABASE_URL
TypeError: Cannot read property 'x' of undefined</pre>
                </div>
                
                <div class="form-group">
                    <h3>Database Schema Issues</h3>
                    <pre>Error: relation "users" does not exist
error: column "email" does not exist</pre>
                </div>
            </div>
        </div>
        
        <div class="debug-panel">
            <h2>Potential Solutions</h2>
            
            <div class="form-group">
                <h3>1. Environment Variables Setup on Render</h3>
                <p>Ensure you've set all required environment variables in your Render dashboard:</p>
                <ul>
                    <li>DATABASE_URL - Your Postgres connection string from Render</li>
                    <li>JWT_SECRET - A secret key for JSON Web Tokens</li>
                    <li>FRONTEND_URL - Your Vercel frontend URL for CORS</li>
                    <li>NODE_ENV - Set to "production"</li>
                </ul>
            </div>
            
            <div class="form-group">
                <h3>2. CORS Configuration</h3>
                <p>In your backend code, make sure CORS is configured to accept requests from your frontend:</p>
                <pre>
const cors = require('cors');
const express = require('express');
const app = express();

// Allow specific origin (your Vercel frontend URL)
app.use(cors({
  origin: process.env.FRONTEND_URL || "https://your-frontend.vercel.app",
  credentials: true
}));</pre>
            </div>
            
            <div class="form-group">
                <h3>3. Database Connection</h3>
                <p>Ensure your database connection code handles SSL requirements for Render Postgres:</p>
                <pre>
const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: {
    rejectUnauthorized: false
  }
});</pre>
            </div>
            
            <div class="form-group">
                <h3>4. API URL Configuration in Frontend</h3>
                <p>Make sure your frontend is pointing to the correct backend URL on Render:</p>
                <pre>
// In your frontend API configuration
const API_BASE_URL = process.env.REACT_APP_API_URL || 
  "https://your-backend.onrender.com";</pre>
            </div>
        </div>
    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
        
        document.getElementById('testConnectionBtn').addEventListener('click', function() {
            const backendUrl = document.getElementById('backendUrl').value;
            const resultDiv = document.getElementById('connectionResults');
            const resultText = document.getElementById('connectionResultText');
            
            if (!backendUrl) {
                resultText.textContent = "Please enter your backend URL first";
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('error');
                return;
            }
            
            this.innerHTML = '<span class="loading"></span> Testing...';
            this.disabled = true;
            
            // Simulate API test (in a real scenario, this would be an actual fetch call)
            setTimeout(() => {
                // This is a simulation - in practice, you would make a real API call
                const success = Math.random() > 0.3; // 70% success rate for demo
                
                if (success) {
                    resultText.textContent = `SUCCESS: Connection to ${backendUrl} established successfully.
                    
Response: {
  "status": "ok",
  "message": "API is responding"
}`;
                    resultDiv.classList.remove('error');
                    resultDiv.classList.add('success');
                } else {
                    resultText.textContent = `ERROR: Failed to connect to ${backendUrl}
                    
Possible causes:
1. Backend server is not running
2. CORS configuration issue
3. Invalid URL
4. Network connectivity issue

Check your Render dashboard to ensure your backend service is running.`;
                    resultDiv.classList.remove('success');
                    resultDiv.classList.add('error');
                }
                
                resultDiv.classList.remove('hidden');
                this.innerHTML = 'Test Connection';
                this.disabled = false;
            }, 1500);
        });
        
        document.getElementById('testSignupBtn').addEventListener('click', function() {
            const backendUrl = document.getElementById('backendUrl').value;
            const name = document.getElementById('testName').value;
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            
            const resultDiv = document.getElementById('signupResults');
            const resultText = document.getElementById('signupResultText');
            
            if (!backendUrl) {
                resultText.textContent = "Please enter your backend URL in the Connection Test tab first";
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('error');
                return;
            }
            
            if (!name || !email || !password) {
                resultText.textContent = "Please fill all signup fields";
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('error');
                return;
            }
            
            this.innerHTML = '<span class="loading"></span> Testing...';
            this.disabled = true;
            
            // Simulate signup test
            setTimeout(() => {
                // This is a simulation - in practice, you would make a real API call
                const success = Math.random() > 0.5; // 50% success rate for demo
                
                if (success) {
                    resultText.textContent = `SUCCESS: Signup test completed.
                    
Request to: ${backendUrl}/api/signup
Payload: {
  "name": "${name}",
  "email": "${email}",
  "password": "********"
}

Response: {
  "status": "success",
  "message": "User created successfully",
  "user": {
    "id": "12345",
    "name": "${name}",
    "email": "${email}"
  }
}`;
                    resultDiv.classList.remove('error');
                    resultDiv.classList.add('success');
                } else {
                    resultText.textContent = `ERROR: Signup failed
                    
Request to: ${backendUrl}/api/signup
Payload: {
  "name": "${name}",
  "email": "${email}",
  "password": "********"
}

Server Response: {
  "error": "Signup failed. Please try again."
}

Common fixes:
1. Check if users table exists in your database
2. Verify environment variables are set correctly
3. Check server logs for detailed error messages
4. Ensure email is unique and password meets requirements`;
                    resultDiv.classList.remove('success');
                    resultDiv.classList.add('error');
                }
                
                resultDiv.classList.remove('hidden');
                this.innerHTML = 'Test Signup';
                this.disabled = false;
            }, 2000);
        });
        
        // Try to guess the backend URL based on common patterns
        window.addEventListener('load', function() {
            // Common Render backend URL pattern
            const exampleUrl = "https://your-app-name.onrender.com";
            document.getElementById('backendUrl').placeholder = exampleUrl;
        });
    </script>
</body>
</html>